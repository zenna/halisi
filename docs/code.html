<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.highlight { background-color: #FFFF00 }

pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">points-to-vec</span>
  <span style="color: #BA2121">&quot;convert pair of points to vector&quot;</span>
  [[<span style="color: #19177C">x1</span> <span style="color: #19177C">y1</span>] [<span style="color: #19177C">x2</span> <span style="color: #19177C">y2</span>]]
  [(<span style="color: #008000">- </span><span style="color: #19177C">x2</span> <span style="color: #19177C">x1</span>) (<span style="color: #008000">- </span><span style="color: #19177C">y2</span> <span style="color: #19177C">y1</span>)])

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">path-avoids-obstacles?</span>
  <span style="color: #BA2121">&quot;Does a 2D path avoid (not pass through) any of the obstacles?</span>

<span style="color: #BA2121">   Path is set of vertices, e.g. [[3,3][9,5]]</span>

<span style="color: #BA2121">   Obstacles is set of edges [e1,..,en]</span>
<span style="color: #BA2121">   where ei is pair of vertices.</span>
<span style="color: #BA2121">   e.g. obstacles = </span>
<span style="color: #BA2121">   [[[3 9][7 9]]</span>
<span style="color: #BA2121">    [[7 9][5 7]]</span>
<span style="color: #BA2121">    [[5 7][3 9]]]&quot;</span>
  [<span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>]
  (<span style="color: #0000FF">every?</span>
    (<span style="color: #008000">for </span>[[<span style="color: #19177C">p0</span> <span style="color: #19177C">p1</span>] (<span style="color: #0000FF">partition</span> <span style="color: #666666">2</span> <span style="color: #666666">1</span> <span style="color: #19177C">path</span>)
          [<span style="color: #19177C">o0</span> <span style="color: #19177C">o1</span>] <span style="color: #19177C">obstacles</span>
           <span style="color: #19177C">:let</span> [[<span style="color: #19177C">u1</span> <span style="color: #19177C">u2</span>] (<span style="color: #0000FF">points-to-vec</span> <span style="color: #19177C">p1</span> <span style="color: #19177C">p0</span>)
                 [<span style="color: #19177C">v1</span> <span style="color: #19177C">v2</span>] (<span style="color: #0000FF">points-to-vec</span> <span style="color: #19177C">o0</span> <span style="color: #19177C">o1</span>)
                 [<span style="color: #19177C">w1</span> <span style="color: #19177C">w2</span>] (<span style="color: #0000FF">points-to-vec</span> <span style="color: #19177C">o0</span> <span style="color: #19177C">p1</span>)
                 <span style="color: #19177C">s</span> (<span style="color: #008000">/ </span>(<span style="color: #008000">- </span>(<span style="color: #008000">* </span><span style="color: #19177C">v2</span> <span style="color: #19177C">w1</span>) (<span style="color: #008000">* </span><span style="color: #19177C">v1</span> <span style="color: #19177C">w2</span>))
                      (<span style="color: #008000">- </span>(<span style="color: #008000">* </span><span style="color: #19177C">v1</span> <span style="color: #19177C">u2</span>) (<span style="color: #008000">* </span><span style="color: #19177C">v2</span> <span style="color: #19177C">u1</span>)))]]
      (<span style="color: #008000">or </span>(<span style="color: #008000">&gt; </span><span style="color: #19177C">s</span> <span style="color: #666666">1.0</span>)
          (<span style="color: #008000">&lt; </span><span style="color: #19177C">s</span> <span style="color: #666666">1.0</span>)))))

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">point-in-box?</span>
  <span style="color: #BA2121">&quot;Is a point inside a box?&quot;</span>
  [[[<span style="color: #19177C">px</span> <span style="color: #19177C">py</span>] <span style="color: #19177C">:as</span> <span style="color: #19177C">point</span>] [[[<span style="color: #19177C">low-x</span> <span style="color: #19177C">up-x</span>][<span style="color: #19177C">low-y</span> <span style="color: #19177C">up-y</span>]] <span style="color: #19177C">:as</span> <span style="color: #19177C">box</span>]]
  (<span style="color: #0000FF">and</span>
    (<span style="color: #008000">&gt;= </span><span style="color: #19177C">px</span> <span style="color: #19177C">low-x</span>)
    (<span style="color: #008000">&lt;= </span><span style="color: #19177C">px</span> <span style="color: #19177C">up-x</span>)
    (<span style="color: #008000">&gt;= </span><span style="color: #19177C">py</span> <span style="color: #19177C">low-y</span>)
    (<span style="color: #008000">&lt;= </span><span style="color: #19177C">py</span> <span style="color: #19177C">up-x</span>)))

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">valid-path?</span>
  <span style="color: #BA2121">&quot;Path is valid if start is in start box, dest is in dest box</span>
<span style="color: #BA2121">   and it avoids obstacles&quot;</span>
  [<span style="color: #19177C">start</span> <span style="color: #19177C">target</span> <span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>]
  (<span style="color: #0000FF">and</span>
    (<span style="color: #0000FF">point-in-box?</span> (<span style="color: #008000">first </span><span style="color: #19177C">path</span>) <span style="color: #19177C">start</span>)
    (<span style="color: #0000FF">point-in-box?</span> (<span style="color: #008000">last </span><span style="color: #19177C">path</span>) <span style="color: #19177C">target</span>)
    (<span style="color: #0000FF">path-avoids-obstacles?</span> <span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>)))

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">gen-path-parametric</span>
  <span style="color: #BA2121">&quot;Generate a random path n-dim dimensions&quot;</span>
  [<span style="color: #19177C">n-dim</span> <span style="color: #19177C">num-points</span>]
  (<span style="color: #0000FF">repeatedly</span> <span style="color: #19177C">num-points</span> <span style="color: #666666">#</span>(<span style="color: #0000FF">vec</span> (<span style="color: #0000FF">repeatedly</span> <span style="color: #19177C">n-dim</span> <span style="color: #19177C">rand</span>))))

(<span style="color: #0000FF">construct</span> (<span style="color: #0000FF">gen-path-parametric</span> <span style="color: #666666">2</span> <span style="color: #666666">2</span>)
           (<span style="color: #008000">partial </span><span style="color: #19177C">valid-path</span> [<span style="color: #666666">1</span> <span style="color: #666666">1</span>] [<span style="color: #666666">9</span> <span style="color: #666666">9</span>] []))

------------------------------------------------------------------------------

An open question is what order we evaluate in.  It's more than just an order though, because we might make choices which are order dependent, and we might
backtrack.

Construct can ignore its first argument for the time being and jump straight
into the <constraint class=""></constraint>
Why?

(<span style="color: #0000FF">construct</span> (<span style="color: #0000FF">gen-path-parametric</span> <span style="color: #666666">2</span> <span style="color: #666666">2</span>)
           <span class="highlight">(<span style="color: #008000">partial </span><span style="color: #19177C">valid-path</span> [<span style="color: #666666">1</span> <span style="color: #666666">1</span>] [<span style="color: #666666">9</span> <span style="color: #666666">9</span>] [])</span>)

We needn't worry about the first three arguments of valid-path, they're not important yet. Instead we focus on 'path'.

We recognise that we can look at either of the arguments to the and, we
decide to take the first one

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">valid-path?</span>
  <span style="color: #BA2121">&quot;Path is valid if start is in start box, dest is in dest box</span>
<span style="color: #BA2121">   and it avoids obstacles&quot;</span>
  [<span style="color: #19177C">start</span> <span style="color: #19177C">target</span> <span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>]
  (<span style="color: #0000FF">and</span>
    <span class="highlight">(<span style="color: #0000FF">point-in-box?</span> (<span style="color: #008000">first </span><span style="color: #19177C">path</span>) <span style="color: #19177C">start</span>)</span>
    (<span style="color: #0000FF">point-in-box?</span> (<span style="color: #008000">last </span><span style="color: #19177C">path</span>) <span style="color: #19177C">target</span>)
    (<span style="color: #0000FF">path-avoids-obstacles?</span> <span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>)))

In <span style="color: #0000FF">point-in-box?</span> we discover some inequality constraints on elements of its first argument.

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">point-in-box?</span>
  <span style="color: #BA2121">&quot;Is a point inside a box?&quot;</span>
  [[[<span style="color: #19177C">px</span> <span style="color: #19177C">py</span>] <span style="color: #19177C">:as</span> <span style="color: #19177C">point</span>] [[[<span style="color: #19177C">low-x</span> <span style="color: #19177C">up-x</span>][<span style="color: #19177C">low-y</span> <span style="color: #19177C">up-y</span>]] <span style="color: #19177C">:as</span> <span style="color: #19177C">box</span>]]
  <span class="highlight">(<span style="color: #0000FF">and</span>
      (<span style="color: #008000">&gt;= </span><span style="color: #19177C">px</span> <span style="color: #19177C">low-x</span>)
      (<span style="color: #008000">&lt;= </span><span style="color: #19177C">px</span> <span style="color: #19177C">up-x</span>)
      (<span style="color: #008000">&gt;= </span><span style="color: #19177C">py</span> <span style="color: #19177C">low-y</span>)
      (<span style="color: #008000">&lt;= </span><span style="color: #19177C">py</span> <span style="color: #19177C">up-x</span>))</span>)

We can trace this back to being the first element of the path:

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">valid-path?</span>
  <span style="color: #BA2121">&quot;Path is valid if start is in start box, dest is in dest box</span>
<span style="color: #BA2121">   and it avoids obstacles&quot;</span>
  [<span style="color: #19177C">start</span> <span style="color: #19177C">target</span> <span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>]
  (<span style="color: #0000FF">and</span>
    (<span style="color: #0000FF">point-in-box?</span> <span class="highlight">(<span style="color: #008000">first </span><span style="color: #19177C">path</span>)</span> <span style="color: #19177C">start</span>)
    (<span style="color: #0000FF">point-in-box?</span> (<span style="color: #008000">last </span><span style="color: #19177C">path</span>) <span style="color: #19177C">target</span>)
    (<span style="color: #0000FF">path-avoids-obstacles?</span> <span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>)))

We trace this back to <span style="color: #19177C">gen-path-parametric</span>, which has its argument partially evaluated.

We see the repeatedly, and we apply the constraint point in box to the first
'iteration' of repeatedly.

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">gen-path-parametric</span>
  <span style="color: #BA2121">&quot;Generate a random path n-dim dimensions&quot;</span>
  [<span style="color: #19177C">n-dim</span> <span style="color: #19177C">num-points</span>]
  (<span style="color: #0000FF">concat</span>
    (<span style="color: #0000FF">construct</span> (<span style="color: #666666">#</span>(<span style="color: #0000FF">vec</span> (<span style="color: #0000FF">repeatedly</span> <span style="color: #19177C">n-dim</span> <span style="color: #19177C">rand</span>))) <span style="color: #666666">#</span>(<span style="color: #0000FF">point-in-box</span> <span style="color: #19177C">%</span> <span style="color: #19177C">start</span>))
    (<span style="color: #0000FF">repeatedly</span> (<span style="color: #008000">dec </span><span style="color: #19177C">num-points</span>) <span style="color: #666666">#</span>(<span style="color: #0000FF">vec</span> (<span style="color: #0000FF">repeatedly</span> <span style="color: #19177C">n-dim</span> <span style="color: #19177C">rand</span>)))))

We do a similar thing for the dest, i.e. the last point in the path.
In fact we can skip skip some reasoning steps to go straight to the answer.

This leaves us with path-avoids-obstacles?

We see the ultimate constraint of this function is an argument to the for loop which is in turn an argument to an every? predicate.
This tells us we can proceed in any order, but we must check them all.
We start at the beginning, hoping to see some regularities.

(<span style="color: #008000; font-weight: bold">defn </span><span style="color: #19177C">path-avoids-obstacles?</span>
  <span style="color: #BA2121">&quot;Does a 2D path avoid (not pass through) any of the obstacles?</span>

<span style="color: #BA2121">   Path is set of vertices, e.g. [[3,3][9,5]]</span>

<span style="color: #BA2121">   Obstacles is set of edges [e1,..,en]</span>
<span style="color: #BA2121">   where ei is pair of vertices.</span>
<span style="color: #BA2121">   e.g. obstacles = </span>
<span style="color: #BA2121">   [[[3 9][7 9]]</span>
<span style="color: #BA2121">    [[7 9][5 7]]</span>
<span style="color: #BA2121">    [[5 7][3 9]]]&quot;</span>
  [<span style="color: #19177C">obstacles</span> <span style="color: #19177C">path</span>]
  (<span class="highlight" style="color: #0000FF">every?</span>
    (<span class="highlight"style="color: #008000">for </span>[[<span style="color: #19177C">p0</span> <span style="color: #19177C">p1</span>] (<span style="color: #0000FF">partition</span> <span style="color: #666666">2</span> <span style="color: #666666">1</span> <span style="color: #19177C">path</span>)
          [<span style="color: #19177C">o0</span> <span style="color: #19177C">o1</span>] <span style="color: #19177C">obstacles</span>
           <span style="color: #19177C">:let</span> [[<span style="color: #19177C">u1</span> <span style="color: #19177C">u2</span>] (<span style="color: #0000FF">points-to-vec</span> <span style="color: #19177C">p1</span> <span style="color: #19177C">p0</span>)
                 [<span style="color: #19177C">v1</span> <span style="color: #19177C">v2</span>] (<span style="color: #0000FF">points-to-vec</span> <span style="color: #19177C">o0</span> <span style="color: #19177C">o1</span>)
                 [<span style="color: #19177C">w1</span> <span style="color: #19177C">w2</span>] (<span style="color: #0000FF">points-to-vec</span> <span style="color: #19177C">o0</span> <span style="color: #19177C">p1</span>)
                 <span style="color: #19177C">s</span> (<span style="color: #008000">/ </span>(<span style="color: #008000">- </span>(<span style="color: #008000">* </span><span style="color: #19177C">v2</span> <span style="color: #19177C">w1</span>) (<span style="color: #008000">* </span><span style="color: #19177C">v1</span> <span style="color: #19177C">w2</span>))
                      (<span style="color: #008000">- </span>(<span style="color: #008000">* </span><span style="color: #19177C">v1</span> <span style="color: #19177C">u2</span>) (<span style="color: #008000">* </span><span style="color: #19177C">v2</span> <span style="color: #19177C">u1</span>)))]]
      <span class="highlight">(<span style="color: #008000">or </span>(<span style="color: #008000">&gt; </span><span style="color: #19177C">s</span> <span style="color: #666666">1.0</span>)
            (<span style="color: #008000">&lt; </span><span style="color: #19177C">s</span> <span style="color: #666666">1.0</span>))</span>)))

I then head to the constraint, realise it is a function of 's', and ask what is 's'.
's'
When $a \ne 0$, there are two solutions to \(ax^2 + bx + c = 0\) and they are
$$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$

</pre>
</div>
</body>
</html>